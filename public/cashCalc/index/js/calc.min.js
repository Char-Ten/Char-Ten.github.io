!function(){var t={"公共支出":"publicCash","比例支出":"ratioCash","参与比例":"ratio"},e=new window.SpeechSynthesisUtterance;e.rate=2,e.pitch=2,Vue.component("x-alert",{template:"#x-alert",props:["title"]}),Vue.component("model-add-person",{template:"#model-addPerson",props:["focus"],data:function(){return{textValue:""}},computed:{isArrowSubmit:function(){return this.textValue}},watch:{focus:function(){this.focus&&this.$refs.input.focus()}},methods:{atv_Submit:function(){this.isArrowSubmit&&(this.$emit("submit",this.textValue),this.textValue="")},atv_cancel:function(){this.textValue="",this.$emit("cancel")}},mounted:function(){this.isFocus}}),Vue.component("table-view",{template:"#table-view",data:function(){return{typeIndex:t,typesCounts:{},isArrowSubmit:!0}},computed:{tableData:function(){return this.$store.state.person},tableContentMaxLength:function(){for(var t=[0],e=0;e<this.tableData.length;e++)t.push(this.tableData[e].publicCash.length),t.push(this.tableData[e].ratioCash.length),t.push(this.tableData[e].ratio.length);return Math.max.apply(Math,t)}},methods:{atv_submitTable:function(){function t(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),s=0;s!=t.length;++s)n[s]=255&t.charCodeAt(s);return e}if(this.isArrowSubmit)if("char-ten.github.io"===location.hostname)try{var e=XLSX.utils.table_to_book(this.$refs.table),n=XLSX.write(e,{type:"binary",bookType:"xlsx",bookSST:!1});saveAs(new Blob([t(n)],{type:"application/octet-stream"}),(new Date).getTime()+".xlsx"),this.isArrowSubmit=!0}catch(t){console.log(t),alert("您的浏览器不支持本地生成excel的功能")}else{this.isArrowSubmit=!1;var s=new XMLHttpRequest,i=this;s.open("post","/api/translate/htmltable2excel",!0),s.onload=function(){i.isArrowSubmit=!0;try{var t=JSON.parse(s.responseText);if("ok"===t.state){var e=window.open(t.data.url,"_blank");e||(window.location.href=t.data.url)}}catch(t){}},s.send(this.$refs.table.innerHTML)}},calc_PersonTypesCount:function(t,e,n){var s=this.util_total(t);return Array.isArray(this.typesCounts[e])?this.typesCounts[e][n]=s:this.typesCounts[e]=[s],s.toFixed(2)},calc_TypesCount:function(t){var e=this.util_total(this.typesCounts[t]);return this.typesCounts[t+"_value"]=e,e.toFixed(2)},calc_TypesCountAverage:function(t,e){var n=this.typesCounts[t+"_value"]||0;if("ratio"===t)return 0===n?0:(100*this.typesCounts[t][e]/n).toFixed(2)+"%";if("ratioCash"===t){var s=this.typesCounts.ratio_value||0,i=this.typesCounts.ratio[e]||0,o=0;return 0!==s&&(o=i/s),(this.typesCounts[t][e]-n*o).toFixed(2)}return(this.typesCounts[t][e]-n/this.tableData.length).toFixed(2)},util_total:function(t){return Array.isArray(t)?0===t.length?0:t.reduce(function(t,e){return isNaN(e)?t:t+e}):0}},mounted:function(){}});var n=new Vuex.Store({state:{hasPerson:{},person:[],history:[]},mutations:{addPerson:function(t,e){var n=[];Array.isArray(e)?e.forEach(function(e,s){t.hasPerson[e.name]||(t.hasPerson[e.name]=1,n.push(e))}):t.hasPerson[e.name]||(t.hasPerson[item.name]=1,n.push(item)),t.person=t.person.concat(n)},addPersonCashType:function(e,n){if(e.hasPerson[n.name]){var s=t[n.type];Array.isArray(e.person[n.index][s])&&e.person[n.index][s].push(n.value)}},removePersonItem:function(t,e){for(var n=0;n<t.person.length;n++)if(e===t.person[n].name)return void t.person.splice(n,1)},clearPerson:function(t){t.person=[]},addHistory:function(t,e){return Array.isArray(e)?void t.history.concat(e):void t.history.push(e)},removeHistoryItem:function(t,e){t.history[e.index]&&(t.history.splice(e.index,e.number),n.commit("rebuildPersonByHistory"))},replaceHistoryItem:function(t,e){t.history[e.index]=e.item,n.commit("rebuildPersonByHistory")},rebuildPersonByHistory:function(e){var n={},s=[];e.person.forEach(function(t,e){s[e]={name:t.name,publicCash:[],ratioCash:[],ratio:[]},n[t.name]=e}),e.history.forEach(function(i){var o=i.split(" "),r=o[0],a=n[r],u=t[o[1].replace(/[【】]/g,"")],h=1*o[2];e.hasPerson[r]?s[a][u].push(h):(s[a]={name:r,publicCash:[],ratioCash:[],ratio:[]},s[a][u].push(h))}),e.person=s}}}),s=new Vue({el:"#app",store:n,data:{isAddModelShow:!1,typesState:["公共支出","比例支出","参与比例"],typesIndex:0,personIndex:0,inputValue:""},computed:{result:function(){var t=this.selectedPerson.name,e="【"+this.selectedType+"】",n=this.inputValue;return[t,e,n].join(" ")},selectedPerson:function(){return this.$store.state.person[this.personIndex]||{}},selectedType:function(){return this.typesState[this.typesIndex]},personState:function(){return this.$store.state.person},historyList:function(){return this.$store.state.history}},watch:{isAddModelShow:function(){this.isAddModelShow||this.$refs.input.focus()}},methods:{atv_ShowAddPersonModel:function(){this.isAddModelShow=!0},atv_AddPerson:function(t){this.isAddModelShow=!1,this.$refs.input.focus();var e=t.split(/[,，]/).map(function(t){return{name:t,publicCash:[],ratioCash:[],ratio:[]}});n.commit("addPerson",e)},atv_KeydownInput:function(t){for(var e=[38,40,37,39],n=0;n<e.length;n++)if(t.keyCode===e[n])return void t.preventDefault()},atv_SubmitInput:function(){var t=this.selectedPerson.name,s=this.selectedType;e.text=[t,s,parseFloat(this.inputValue)].join(" "),window.speechSynthesis.speak(e),t&&s&&this.inputValue&&(n.commit("addHistory",this.result),n.commit("addPersonCashType",{name:t,type:s,value:parseFloat(this.inputValue),index:this.personIndex}),this.inputValue="")},atv_TypesIndexAdd:function(t){t.preventDefault(),this.typesIndex=this.util_AddValue(this.typesIndex,this.typesState.length),this.util_speak()},atv_TypesIndexSub:function(t){t.preventDefault(),this.typesIndex=this.util_SubValue(this.typesIndex,this.typesState.length),this.util_speak()},atv_PersonIndexAdd:function(t){t.preventDefault(),this.personIndex=this.util_AddValue(this.personIndex,Object.keys(this.personState).length),this.util_speak()},atv_PersonIndexSub:function(t){t.preventDefault(),this.personIndex=this.util_SubValue(this.personIndex,Object.keys(this.personState).length),this.util_speak()},util_speak:function(t){var n=this.selectedPerson.name,s=this.selectedType,i=this.inputValue;e.text=[n,s,i].join(" "),window.speechSynthesis.speak(e)},util_AddValue:function(t,e){return t++,t>=e&&(t-=e),t},util_SubValue:function(t,e){return t--,t<0&&(t+=e),t}},mounted:function(){this.$refs.input.focus(),window.addEventListener("keyup",function(t){83!==t.keyCode&&40!==t.keyCode||s.atv_TypesIndexAdd(t),87!==t.keyCode&&38!==t.keyCode||s.atv_TypesIndexSub(t),65!==t.keyCode&&37!==t.keyCode||s.atv_PersonIndexSub(t),68!==t.keyCode&&39!==t.keyCode||s.atv_PersonIndexAdd(t),t.ctrlKey&&90===t.keyCode&&n.commit("removeHistoryItem",{index:s.historyList.length-1,number:1})})}})}();
